<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Voto Electr√≥nico</title>
    <meta name="theme-color" content="#2c3e50">
    <meta name="description" content="Sistema seguro de voto electr√≥nico">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üó≥Ô∏è</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üó≥Ô∏è</text></svg>">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --gray-color: #95a5a6;
            --border-radius: 12px;
            --box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1a2530 100%);
            color: white;
            padding: 1.2rem 0;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            font-size: 1.4rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            font-size: 1.8rem;
        }
        
        .auth-buttons {
            display: flex;
            gap: 12px;
        }
        
        .auth-buttons button {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 10px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .auth-buttons button:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .install-btn {
            background: var(--success-color) !important;
            border-color: var(--success-color) !important;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            margin-bottom: 25px;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.15);
        }
        
        h1, h2, h3, h4 {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-weight: 700;
        }
        
        h1 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e8ed;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        button {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
            border: none;
            padding: 16px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: var(--transition);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        button.danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }
        
        button.success {
            background: linear-gradient(135deg, var(--success-color), #219653);
        }
        
        button.warning {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
        }
        
        .user-type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .user-card {
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            padding: 30px;
            border: 2px solid transparent;
        }
        
        .user-card:hover {
            transform: translateY(-8px);
            border-color: var(--secondary-color);
        }
        
        .user-card h3 {
            margin-top: 15px;
            font-size: 1.4rem;
        }
        
        .user-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }
        
        .election-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .election-card {
            border-left: 6px solid var(--secondary-color);
        }
        
        .candidate-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .candidate-card {
            text-align: center;
            padding: 20px;
            border: 2px solid #e1e8ed;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .candidate-card:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.15);
            transform: translateY(-5px);
        }
        
        .candidate-card.selected {
            border-color: var(--success-color);
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.05), rgba(52, 152, 219, 0.05));
            transform: scale(1.02);
        }
        
        .candidate-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            display: block;
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 4px solid #e1e8ed;
            transition: var(--transition);
        }
        
        .candidate-card.selected .candidate-image {
            border-color: var(--success-color);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 25px 0;
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            box-shadow: var(--box-shadow);
            color: white;
        }
        
        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-success {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(39, 174, 96, 0.05));
            border-left: 5px solid var(--success-color);
            color: #155724;
        }
        
        .alert-error {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(231, 76, 60, 0.05));
            border-left: 5px solid var(--danger-color);
            color: #721c24;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            font-size: 0.95rem;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }
        
        th, td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }
        
        th {
            background: linear-gradient(135deg, var(--primary-color), #1a2530);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }
        
        .back-button {
            background: linear-gradient(135deg, var(--gray-color), #7f8c8d);
            margin-bottom: 20px;
            width: auto;
            display: inline-flex;
            padding: 12px 20px;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .action-buttons button {
            width: auto;
            flex: 1;
        }
        
        .file-upload-area {
            border: 3px dashed #bdc3c7;
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            border-color: var(--secondary-color);
            background: rgba(52, 152, 219, 0.05);
        }
        
        .file-upload-area.dragover {
            border-color: var(--success-color);
            background: rgba(39, 174, 96, 0.1);
        }
        
        .file-input {
            display: none;
        }
        
        .voter-list, .candidate-list-admin {
            max-height: 350px;
            overflow-y: auto;
            margin-top: 20px;
            border: 2px solid #e1e8ed;
            border-radius: var(--border-radius);
            padding: 15px;
        }
        
        .voter-item, .candidate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .voter-item:last-child, .candidate-item:last-child {
            border-bottom: none;
        }
        
        .voter-info, .candidate-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .candidate-image-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border: 2px solid #e1e8ed;
        }
        
        .voter-email {
            font-size: 1rem;
            font-weight: 500;
        }
        
        .remove-voter, .remove-candidate {
            color: var(--danger-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .remove-voter:hover, .remove-candidate:hover {
            background: rgba(231, 76, 60, 0.1);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 25px 30px;
            border-bottom: 2px solid #e1e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-footer {
            padding: 20px 30px;
            border-top: 2px solid #e1e8ed;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            background: #f8f9fa;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--gray-color);
            width: auto;
            padding: 0;
        }
        
        .candidate-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .candidate-form input {
            flex: 1;
        }
        
        .candidate-form button {
            width: auto;
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            display: block;
            border: 3px solid #e1e8ed;
        }
        
        .voter-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .voter-form input {
            flex: 1;
        }
        
        .voter-form button {
            width: auto;
        }
        
        .chart-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .chart-tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: 2px solid #e1e8ed;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .chart-tab.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        .chart-tab:hover {
            transform: translateY(-2px);
        }
        
        .percentage-bar {
            background: #e1e8ed;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
        }
        
        .percentage-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease;
            position: relative;
        }
        
        .percentage-text {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            font-size: 0.9rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .user-type-selector {
                grid-template-columns: 1fr;
            }
            
            .candidate-list {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .candidate-form, .voter-form {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">üó≥Ô∏è</span>
                <span>Voto Electr√≥nico</span>
            </div>
            <div class="auth-buttons">
                <button id="installBtn" class="install-btn" style="display: none;">
                    <span>üì≤</span> Instalar App
                </button>
                <button id="logoutBtn" style="display: none;">
                    <span>üö™</span> Cerrar Sesi√≥n
                </button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- P√°gina de inicio -->
        <div id="homePage" class="page active">
            <div class="card">
                <h1>Sistema de Voto Electr√≥nico Seguro</h1>
                <p style="text-align: center; font-size: 1.1rem; color: var(--dark-color); margin-bottom: 30px;">
                    Plataforma moderna y segura para procesos electorales digitales
                </p>
                
                <div class="user-type-selector">
                    <div class="user-card card" id="adminCard">
                        <div class="user-icon">üë®‚Äçüíº</div>
                        <h3>Administrador</h3>
                        <p>Gesti√≥n completa del sistema electoral</p>
                    </div>
                    <div class="user-card card" id="voterCard">
                        <div class="user-icon">üë§</div>
                        <h3>Votante</h3>
                        <p>Participa en las elecciones activas</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>üì± Aplicaci√≥n M√≥vil</h3>
                <p>Para una mejor experiencia, instale esta aplicaci√≥n en su dispositivo.</p>
                <button id="installInfoBtn">
                    <span>‚ÑπÔ∏è</span> C√≥mo instalar
                </button>
            </div>
        </div>

        <!-- P√°gina de login para administrador -->
        <div id="adminLoginPage" class="page">
            <button class="back-button" id="backToHomeFromAdminLogin">
                <span>‚Üê</span> Volver al Inicio
            </button>
            <div class="card">
                <h2>üîê Acceso Administrador</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminEmail">üìß Correo Electr√≥nico</label>
                        <input type="email" id="adminEmail" value="edujavi01@gmail.com" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">üîí Contrase√±a</label>
                        <input type="password" id="adminPassword" value="alfa72567" required>
                    </div>
                    <div class="form-group">
                        <label for="adminDNI">üÜî DNI</label>
                        <input type="text" id="adminDNI" value="46122321" required>
                    </div>
                    <button type="submit" class="success">
                        <span>üöÄ</span> Ingresar al Panel
                    </button>
                </form>
            </div>
        </div>

        <!-- P√°gina de login para votante -->
        <div id="voterLoginPage" class="page">
            <button class="back-button" id="backToHomeFromVoterLogin">
                <span>‚Üê</span> Volver al Inicio
            </button>
            <div class="card">
                <h2>üë§ Acceso Votante</h2>
                <form id="voterLoginForm">
                    <div class="form-group">
                        <label for="voterEmail">üìß Correo Electr√≥nico</label>
                        <input type="email" id="voterEmail" placeholder="tu@email.com" required>
                    </div>
                    <button type="submit" class="success">
                        <span>üó≥Ô∏è</span> Ingresar a Votar
                    </button>
                </form>
            </div>
        </div>

        <!-- Panel de administraci√≥n -->
        <div id="adminPanelPage" class="page">
            <button class="back-button" id="backFromAdminPanel">
                <span>‚Üê</span> Cerrar Sesi√≥n
            </button>
            <div class="card">
                <h2>üéõÔ∏è Panel de Administraci√≥n</h2>
                <div id="adminAlert"></div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalElections">0</div>
                        <div class="stat-label">Elecciones Activas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalVoters">0</div>
                        <div class="stat-label">Votantes Registrados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalVotes">0</div>
                        <div class="stat-label">Votos Emitidos</div>
                    </div>
                </div>
                
                <h3>üÜï Crear Nueva Elecci√≥n</h3>
                <form id="createElectionForm">
                    <div class="form-group">
                        <label for="electionName">üìù Nombre de la Elecci√≥n</label>
                        <input type="text" id="electionName" placeholder="Ej: Elecci√≥n de Representante 2024" required>
                    </div>
                    <div class="form-group">
                        <label for="electionDescription">üìÑ Descripci√≥n</label>
                        <textarea id="electionDescription" rows="3" placeholder="Descripci√≥n detallada de la elecci√≥n..." required></textarea>
                    </div>
                    
                    <h4>üë• Gesti√≥n de Candidatos</h4>
                    <div class="form-group">
                        <label>Agregar candidatos</label>
                        <div class="candidate-form">
                            <input type="text" id="candidateName" placeholder="Nombre del candidato">
                            <input type="file" id="candidatePhoto" accept="image/*" class="file-input" style="display: none;">
                            <button type="button" id="candidatePhotoBtn" class="warning" style="width: auto;">
                                <span>üñºÔ∏è</span> Foto
                            </button>
                            <button type="button" id="addCandidateBtn" class="success" style="width: auto;">
                                <span>‚ûï</span> Agregar
                            </button>
                        </div>
                        <div id="candidatePhotoPreview" style="text-align: center; margin-top: 15px;"></div>
                    </div>
                    
                    <div class="candidate-list-admin" id="candidateListAdmin">
                        <!-- Los candidatos se mostrar√°n aqu√≠ -->
                    </div>
                    
                    <h4>üë• Gesti√≥n de Votantes</h4>
                    <div class="form-group">
                        <label>Agregar votantes individualmente</label>
                        <div class="voter-form">
                            <input type="email" id="voterEmailInput" placeholder="correo@ejemplo.com" style="flex: 1;">
                            <button type="button" id="addVoterBtn" class="success" style="width: auto;">
                                <span>‚ûï</span> Agregar
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>üìä O importar desde Excel</label>
                        <div class="file-upload-area" id="fileUploadArea">
                            <p style="font-size: 1.2rem; margin-bottom: 10px;">üìÅ Arrastra un archivo Excel aqu√≠</p>
                            <p class="voter-email">Formato: Correo Electr√≥nico</p>
                            <input type="file" id="excelFile" class="file-input" accept=".xlsx, .xls">
                        </div>
                        <div class="action-buttons">
                            <button type="button" id="downloadTemplateBtn" class="warning">
                                <span>üì•</span> Descargar Plantilla
                            </button>
                            <button type="button" id="exportVotersBtn" class="success" style="display: none;">
                                <span>üì§</span> Exportar Votantes
                            </button>
                        </div>
                    </div>
                    
                    <div class="voter-list" id="voterList">
                        <!-- Los votantes se mostrar√°n aqu√≠ -->
                    </div>
                    
                    <button type="submit" class="success">
                        <span>‚úÖ</span> Crear Elecci√≥n
                    </button>
                </form>
            </div>

            <div class="card">
                <h3>üìä Elecciones Activas</h3>
                <div id="electionsList" class="election-list">
                    <!-- Las elecciones se cargar√°n aqu√≠ din√°micamente -->
                </div>
            </div>

            <div class="card">
                <h3>üìà Reporte de Votantes</h3>
                <table id="votersTable">
                    <thead>
                        <tr>
                            <th>üìß Correo Electr√≥nico</th>
                            <th>üó≥Ô∏è Elecci√≥n</th>
                            <th>üìä Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Los datos de votantes se cargar√°n aqu√≠ din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Panel de votaci√≥n -->
        <div id="votingPage" class="page">
            <button class="back-button" id="backFromVoting">
                <span>‚Üê</span> Volver
            </button>
            <div class="card">
                <h2 id="electionTitle">üó≥Ô∏è Elecci√≥n en Curso</h2>
                <p id="electionDescriptionText" style="font-size: 1.1rem; color: var(--dark-color); margin-bottom: 25px;">
                    Descripci√≥n de la elecci√≥n
                </p>
                
                <div id="candidatesList" class="candidate-list">
                    <!-- Los candidatos se cargar√°n aqu√≠ din√°micamente -->
                </div>
                
                <button id="submitVote" class="success" style="display: none; margin-top: 30px;">
                    <span>‚úÖ</span> Confirmar Mi Voto
                </button>
                <div id="voteAlert"></div>
            </div>
        </div>

        <!-- P√°gina de confirmaci√≥n de voto -->
        <div id="voteConfirmationPage" class="page">
            <div class="card" style="text-align: center;">
                <div style="font-size: 6rem; margin: 20px 0;">‚úÖ</div>
                <h2 style="color: var(--success-color);">¬°Voto Registrado Exitosamente!</h2>
                <p style="font-size: 1.2rem; margin: 20px 0; color: var(--dark-color);">
                    Su voto ha sido registrado de manera segura y an√≥nima en el sistema.
                </p>
                <p style="color: var(--gray-color); margin-bottom: 30px;">
                    Gracias por participar en el proceso electoral democr√°tico.
                </p>
                <button id="backToHomeFromConfirmation" class="success" style="max-width: 300px; margin: 0 auto;">
                    <span>üè†</span> Volver al Inicio
                </button>
            </div>
        </div>

        <!-- P√°gina de informaci√≥n de instalaci√≥n -->
        <div id="installInfoPage" class="page">
            <button class="back-button" id="backFromInstallInfo">
                <span>‚Üê</span> Volver al Inicio
            </button>
            <div class="card">
                <h2>üì± Instalar la Aplicaci√≥n</h2>
                <div class="install-step" style="margin-bottom: 25px;">
                    <h3>ü§ñ En Android:</h3>
                    <p>1. Abra el men√∫ de opciones (tres puntos) en Chrome</p>
                    <p>2. Seleccione "Agregar a la pantalla de inicio"</p>
                    <p>3. Confirme la instalaci√≥n</p>
                </div>
                <div class="install-step" style="margin-bottom: 25px;">
                    <h3>üçé En iPhone/iPad:</h3>
                    <p>1. Pulse el √≠cono de compartir (cuadrado con flecha)</p>
                    <p>2. Despl√°cese y seleccione "Agregar a pantalla de inicio"</p>
                    <p>3. Confirme la instalaci√≥n</p>
                </div>
                <button id="tryInstallBtn">
                    <span>üîß</span> Intentar Instalaci√≥n Autom√°tica
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para resultados -->
    <div id="resultsModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="resultsModalTitle">üìä Resultados de Elecci√≥n</h3>
                <button class="close-modal" id="closeResultsModal">√ó</button>
            </div>
            <div class="modal-body" id="resultsModalBody">
                <div class="chart-tabs" id="chartTabs">
                    <div class="chart-tab active" data-chart="bar">üìä Gr√°fico de Barras</div>
                    <div class="chart-tab" data-chart="pie">ü•ß Gr√°fico Circular</div>
                    <div class="chart-tab" data-chart="doughnut">üç© Gr√°fico de Dona</div>
                    <div class="chart-tab" data-chart="polarArea">üéØ Gr√°fico Polar</div>
                </div>
                <div class="chart-container">
                    <canvas id="resultsChart"></canvas>
                </div>
                <div id="resultsDetails">
                    <!-- Los detalles de resultados se cargar√°n aqu√≠ -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="exportResultsBtn" class="success">
                    <span>üì•</span> Exportar Resultados
                </button>
                <button id="closeResultsBtn" class="back-button">
                    <span>‚ùå</span> Cerrar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Datos de ejemplo para la demostraci√≥n
        let elections = [
            {
                id: 1,
                name: "Elecci√≥n de Representante Estudiantil 2024",
                description: "Elecci√≥n para elegir al representante estudiantil del a√±o acad√©mico 2024",
                candidates: [
                    { name: "Mar√≠a Gonz√°lez", photo: null },
                    { name: "Carlos Rodr√≠guez", photo: null },
                    { name: "Ana Mart√≠nez", photo: null },
                    { name: "David L√≥pez", photo: null }
                ],
                votes: {
                    "votante1@ejemplo.com": 0,
                    "votante2@ejemplo.com": 1,
                    "votante3@ejemplo.com": 2,
                    "votante4@ejemplo.com": 0,
                    "votante5@ejemplo.com": 1,
                    "votante6@ejemplo.com": 3,
                    "votante7@ejemplo.com": 2,
                    "votante8@ejemplo.com": 0,
                    "votante9@ejemplo.com": 1,
                    "votante10@ejemplo.com": 3
                },
                voters: [
                    "votante1@ejemplo.com", "votante2@ejemplo.com", "votante3@ejemplo.com",
                    "votante4@ejemplo.com", "votante5@ejemplo.com", "votante6@ejemplo.com",
                    "votante7@ejemplo.com", "votante8@ejemplo.com", "votante9@ejemplo.com",
                    "votante10@ejemplo.com"
                ]
            },
            {
                id: 2,
                name: "Elecci√≥n de Comit√© de Empresa",
                description: "Elecci√≥n para los miembros del comit√© de empresa 2024",
                candidates: [
                    { name: "Juan P√©rez", photo: null },
                    { name: "Laura S√°nchez", photo: null },
                    { name: "Pedro L√≥pez", photo: null },
                    { name: "Sof√≠a Garc√≠a", photo: null },
                    { name: "Miguel √Ångel Ruiz", photo: null }
                ],
                votes: {
                    "empleado1@empresa.com": 0,
                    "empleado2@empresa.com": 1,
                    "empleado3@empresa.com": 2,
                    "empleado4@empresa.com": 3,
                    "empleado5@empresa.com": 4,
                    "empleado6@empresa.com": 0,
                    "empleado7@empresa.com": 1,
                    "empleado8@empresa.com": 2
                },
                voters: [
                    "empleado1@empresa.com", "empleado2@empresa.com", "empleado3@empresa.com",
                    "empleado4@empresa.com", "empleado5@empresa.com", "empleado6@empresa.com",
                    "empleado7@empresa.com", "empleado8@empresa.com"
                ]
            }
        ];

        let currentUser = null;
        let currentElection = null;
        let selectedCandidate = null;
        let deferredPrompt = null;
        let currentVoters = [];
        let currentCandidates = [];
        let currentCandidatePhoto = null;
        let resultsChart = null;

        // Elementos del DOM
        const pages = {
            home: document.getElementById('homePage'),
            adminLogin: document.getElementById('adminLoginPage'),
            voterLogin: document.getElementById('voterLoginPage'),
            adminPanel: document.getElementById('adminPanelPage'),
            voting: document.getElementById('votingPage'),
            voteConfirmation: document.getElementById('voteConfirmationPage'),
            installInfo: document.getElementById('installInfoPage')
        };

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            showPage('home');
            loadData();
            setupEventListeners();
            updateStats();
        });

        // Configurar event listeners
        function setupEventListeners() {
            // Botones de navegaci√≥n
            document.getElementById('adminCard').addEventListener('click', () => showPage('adminLogin'));
            document.getElementById('voterCard').addEventListener('click', () => showPage('voterLogin'));
            document.getElementById('backToHomeFromAdminLogin').addEventListener('click', () => showPage('home'));
            document.getElementById('backToHomeFromVoterLogin').addEventListener('click', () => showPage('home'));
            document.getElementById('backFromAdminPanel').addEventListener('click', () => {
                currentUser = null;
                showPage('home');
            });
            document.getElementById('backFromVoting').addEventListener('click', () => {
                if (currentUser && currentUser.type === 'voter') {
                    showPage('voterLogin');
                } else {
                    showPage('home');
                }
            });
            document.getElementById('backToHomeFromConfirmation').addEventListener('click', () => {
                currentUser = null;
                showPage('home');
            });
            document.getElementById('logoutBtn').addEventListener('click', () => {
                currentUser = null;
                document.getElementById('logoutBtn').style.display = 'none';
                showPage('home');
            });
            document.getElementById('installInfoBtn').addEventListener('click', () => showPage('installInfo'));
            document.getElementById('backFromInstallInfo').addEventListener('click', () => showPage('home'));
            document.getElementById('tryInstallBtn').addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('Usuario acept√≥ la instalaci√≥n');
                        }
                        deferredPrompt = null;
                    });
                } else {
                    showAlert('adminAlert', 'La instalaci√≥n autom√°tica no est√° disponible. Siga las instrucciones manuales.', 'error');
                }
            });

            // Formularios
            document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
            document.getElementById('voterLoginForm').addEventListener('submit', handleVoterLogin);
            document.getElementById('createElectionForm').addEventListener('submit', handleCreateElection);
            document.getElementById('submitVote').addEventListener('click', handleVoteSubmission);
            
            // Gesti√≥n de candidatos
            document.getElementById('addCandidateBtn').addEventListener('click', addCandidate);
            document.getElementById('candidatePhotoBtn').addEventListener('click', () => {
                document.getElementById('candidatePhoto').click();
            });
            document.getElementById('candidatePhoto').addEventListener('change', handleCandidatePhotoUpload);
            
            // Gesti√≥n de votantes
            document.getElementById('addVoterBtn').addEventListener('click', addVoterManually);
            document.getElementById('downloadTemplateBtn').addEventListener('click', downloadTemplate);
            document.getElementById('exportVotersBtn').addEventListener('click', exportVoters);
            
            // Gesti√≥n de archivos
            document.getElementById('fileUploadArea').addEventListener('click', () => {
                document.getElementById('excelFile').click();
            });
            document.getElementById('excelFile').addEventListener('change', handleExcelUpload);
            
            // Modal de resultados
            document.getElementById('closeResultsModal').addEventListener('click', closeResultsModal);
            document.getElementById('closeResultsBtn').addEventListener('click', closeResultsModal);
            document.getElementById('exportResultsBtn').addEventListener('click', exportResults);
            
            // Tabs de gr√°ficos
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const chartType = this.getAttribute('data-chart');
                    updateChart(chartType);
                });
            });
            
            // Drag and drop para archivos
            setupDragAndDrop();
        }

        // Configurar drag and drop para archivos
        function setupDragAndDrop() {
            const fileUploadArea = document.getElementById('fileUploadArea');
            
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });
            
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    document.getElementById('excelFile').files = e.dataTransfer.files;
                    handleExcelUpload();
                }
            });
        }

        // Funci√≥n para mostrar una p√°gina espec√≠fica
        function showPage(pageName) {
            Object.values(pages).forEach(page => {
                page.classList.remove('active');
            });
            pages[pageName].classList.add('active');
            document.getElementById('adminAlert').innerHTML = '';
            document.getElementById('voteAlert').innerHTML = '';
        }

        // Manejo del login del administrador
        function handleAdminLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const dni = document.getElementById('adminDNI').value;
            
            if (email === 'edujavi01@gmail.com' && password === 'alfa72567' && dni === '46122321') {
                currentUser = { type: 'admin', email };
                document.getElementById('logoutBtn').style.display = 'block';
                showPage('adminPanel');
                loadAdminPanel();
            } else {
                showAlert('adminAlert', 'Credenciales incorrectas. Intente nuevamente.', 'error');
            }
        }

        // Manejo del login del votante
        function handleVoterLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('voterEmail').value;
            const voterElections = elections.filter(election => 
                election.voters.includes(email)
            );
            
            if (voterElections.length > 0) {
                currentUser = { type: 'voter', email };
                currentElection = voterElections[0];
                showPage('voting');
                loadVotingInterface();
            } else {
                showAlert('voteAlert', 'Su correo no est√° registrado para votar en ninguna elecci√≥n.', 'error');
            }
        }

        // Cargar el panel de administraci√≥n
        function loadAdminPanel() {
            const electionsList = document.getElementById('electionsList');
            electionsList.innerHTML = '';
            
            if (elections.length === 0) {
                electionsList.innerHTML = '<p style="text-align: center; color: var(--gray-color); padding: 30px;">No hay elecciones creadas a√∫n.</p>';
            } else {
                elections.forEach(election => {
                    const totalVotes = Object.keys(election.votes).length;
                    const totalVoters = election.voters.length;
                    const progressPercentage = totalVoters > 0 ? (totalVotes / totalVoters * 100) : 0;
                    
                    const electionCard = document.createElement('div');
                    electionCard.className = 'election-card card';
                    electionCard.innerHTML = `
                        <h3>${election.name}</h3>
                        <p>${election.description}</p>
                        <div style="margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span><strong>Progreso:</strong> ${totalVotes}/${totalVoters} votos</span>
                                <span><strong>${progressPercentage.toFixed(1)}%</strong></span>
                            </div>
                            <div style="background: #e1e8ed; border-radius: 10px; height: 10px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, var(--success-color), var(--secondary-color)); height: 100%; width: ${progressPercentage}%;"></div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button onclick="viewElectionResults(${election.id})" class="success">
                                <span>üìä</span> Ver Resultados
                            </button>
                            <button onclick="deleteElection(${election.id})" class="danger">
                                <span>üóëÔ∏è</span> Eliminar
                            </button>
                        </div>
                    `;
                    electionsList.appendChild(electionCard);
                });
            }
            
            loadVotersReport();
            updateStats();
            currentVoters = [];
            currentCandidates = [];
            renderVoterList();
            renderCandidateList();
        }

        // Cargar reporte de votantes
        function loadVotersReport() {
            const votersTable = document.getElementById('votersTable').querySelector('tbody');
            votersTable.innerHTML = '';
            
            if (elections.length === 0) {
                votersTable.innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 30px; color: var(--gray-color);">No hay datos de votantes</td></tr>';
            } else {
                elections.forEach(election => {
                    election.voters.forEach(voterEmail => {
                        const hasVoted = election.votes && election.votes[voterEmail] !== undefined;
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${voterEmail}</td>
                            <td>${election.name}</td>
                            <td>${hasVoted ? '‚úÖ Vot√≥' : '‚è≥ Pendiente'}</td>
                        `;
                        votersTable.appendChild(row);
                    });
                });
            }
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            const totalElections = elections.length;
            const totalVoters = elections.reduce((sum, election) => sum + election.voters.length, 0);
            const totalVotes = elections.reduce((sum, election) => sum + Object.keys(election.votes).length, 0);
            
            document.getElementById('totalElections').textContent = totalElections;
            document.getElementById('totalVoters').textContent = totalVoters;
            document.getElementById('totalVotes').textContent = totalVotes;
        }

        // Agregar candidato
        function addCandidate() {
            const name = document.getElementById('candidateName').value.trim();
            
            if (!name) {
                showAlert('adminAlert', 'Por favor, ingrese el nombre del candidato.', 'error');
                return;
            }
            
            const candidate = { name, photo: currentCandidatePhoto };
            currentCandidates.push(candidate);
            renderCandidateList();
            
            document.getElementById('candidateName').value = '';
            document.getElementById('candidatePhotoPreview').innerHTML = '';
            currentCandidatePhoto = null;
            
            showAlert('adminAlert', 'Candidato agregado correctamente.', 'success');
        }

        // Manejar subida de foto de candidato
        function handleCandidatePhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showAlert('adminAlert', 'Por favor, seleccione un archivo de imagen v√°lido.', 'error');
                return;
            }
            
            if (file.size > 2 * 1024 * 1024) {
                showAlert('adminAlert', 'La imagen no debe superar los 2MB.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                currentCandidatePhoto = e.target.result;
                const preview = document.getElementById('candidatePhotoPreview');
                preview.innerHTML = `
                    <img src="${currentCandidatePhoto}" class="image-preview" alt="Vista previa">
                    <p style="color: var(--success-color); font-weight: 600;">Vista previa de la foto</p>
                `;
            };
            reader.readAsDataURL(file);
        }

        // Renderizar lista de candidatos
        function renderCandidateList() {
            const candidateList = document.getElementById('candidateListAdmin');
            candidateList.innerHTML = '';
            
            if (currentCandidates.length === 0) {
                candidateList.innerHTML = '<p style="text-align: center; color: var(--gray-color); padding: 20px;">No hay candidatos agregados</p>';
            } else {
                currentCandidates.forEach((candidate, index) => {
                    const candidateItem = document.createElement('div');
                    candidateItem.className = 'candidate-item';
                    candidateItem.innerHTML = `
                        <div class="candidate-info">
                            ${candidate.photo ? 
                                `<img src="${candidate.photo}" class="candidate-image-small" alt="${candidate.name}">` :
                                `<div class="candidate-image-small">${candidate.name.charAt(0)}</div>`
                            }
                            <strong>${candidate.name}</strong>
                        </div>
                        <span class="remove-candidate" onclick="removeCandidate(${index})">‚ùå</span>
                    `;
                    candidateList.appendChild(candidateItem);
                });
            }
        }

        // Eliminar candidato
        function removeCandidate(index) {
            currentCandidates.splice(index, 1);
            renderCandidateList();
        }

        // Agregar votante manualmente
        function addVoterManually() {
            const email = document.getElementById('voterEmailInput').value.trim();
            
            if (!email) {
                showAlert('adminAlert', 'Por favor, ingrese un correo electr√≥nico.', 'error');
                return;
            }
            
            if (!isValidEmail(email)) {
                showAlert('adminAlert', 'Por favor, ingrese un correo electr√≥nico v√°lido.', 'error');
                return;
            }
            
            if (currentVoters.includes(email)) {
                showAlert('adminAlert', 'Este correo electr√≥nico ya ha sido agregado.', 'error');
                return;
            }
            
            currentVoters.push(email);
            renderVoterList();
            document.getElementById('voterEmailInput').value = '';
            showAlert('adminAlert', 'Votante agregado correctamente.', 'success');
        }

        // Renderizar lista de votantes
        function renderVoterList() {
            const voterList = document.getElementById('voterList');
            voterList.innerHTML = '';
            
            if (currentVoters.length === 0) {
                voterList.innerHTML = '<p style="text-align: center; color: var(--gray-color); padding: 20px;">No hay votantes agregados</p>';
                document.getElementById('exportVotersBtn').style.display = 'none';
            } else {
                currentVoters.forEach((voterEmail, index) => {
                    const voterItem = document.createElement('div');
                    voterItem.className = 'voter-item';
                    voterItem.innerHTML = `
                        <div class="voter-info">
                            <span class="voter-email">${voterEmail}</span>
                        </div>
                        <span class="remove-voter" onclick="removeVoter(${index})">‚ùå</span>
                    `;
                    voterList.appendChild(voterItem);
                });
                document.getElementById('exportVotersBtn').style.display = 'block';
            }
        }

        // Eliminar votante
        function removeVoter(index) {
            currentVoters.splice(index, 1);
            renderVoterList();
        }

        // Manejar la creaci√≥n de una nueva elecci√≥n
        function handleCreateElection(e) {
            e.preventDefault();
            
            const name = document.getElementById('electionName').value;
            const description = document.getElementById('electionDescription').value;
            
            if (currentCandidates.length < 2) {
                showAlert('adminAlert', 'Debe haber al menos 2 candidatos.', 'error');
                return;
            }
            
            if (currentVoters.length < 1) {
                showAlert('adminAlert', 'Debe haber al menos 1 votante.', 'error');
                return;
            }
            
            const newElection = {
                id: elections.length > 0 ? Math.max(...elections.map(e => e.id)) + 1 : 1,
                name,
                description,
                candidates: [...currentCandidates],
                votes: {},
                voters: [...currentVoters]
            };
            
            elections.push(newElection);
            document.getElementById('createElectionForm').reset();
            currentVoters = [];
            currentCandidates = [];
            renderVoterList();
            renderCandidateList();
            document.getElementById('candidatePhotoPreview').innerHTML = '';
            loadAdminPanel();
            showAlert('adminAlert', 'Elecci√≥n creada exitosamente.', 'success');
            saveData();
        }

        // Cargar la interfaz de votaci√≥n
        function loadVotingInterface() {
            document.getElementById('electionTitle').textContent = currentElection.name;
            document.getElementById('electionDescriptionText').textContent = currentElection.description;
            
            const candidatesList = document.getElementById('candidatesList');
            candidatesList.innerHTML = '';
            
            currentElection.candidates.forEach((candidate, index) => {
                const candidateCard = document.createElement('div');
                candidateCard.className = 'candidate-card';
                candidateCard.innerHTML = `
                    ${candidate.photo ? 
                        `<img src="${candidate.photo}" class="candidate-image" alt="${candidate.name}">` :
                        `<div class="candidate-image">${candidate.name.charAt(0)}</div>`
                    }
                    <h3>${candidate.name}</h3>
                `;
                candidateCard.addEventListener('click', () => selectCandidate(index, candidateCard));
                candidatesList.appendChild(candidateCard);
            });
            
            if (currentElection.votes[currentUser.email] !== undefined) {
                document.getElementById('submitVote').style.display = 'none';
                showAlert('voteAlert', 'Usted ya ha votado en esta elecci√≥n.', 'error');
            } else {
                document.getElementById('submitVote').style.display = 'block';
            }
        }

        // Seleccionar un candidato
        function selectCandidate(candidateIndex, candidateElement) {
            document.querySelectorAll('.candidate-card').forEach(card => {
                card.classList.remove('selected');
            });
            candidateElement.classList.add('selected');
            selectedCandidate = candidateIndex;
        }

        // Manejar el env√≠o del voto
        function handleVoteSubmission() {
            if (selectedCandidate === null) {
                showAlert('voteAlert', 'Por favor, seleccione un candidato antes de votar.', 'error');
                return;
            }
            
            currentElection.votes[currentUser.email] = selectedCandidate;
            saveData();
            showPage('voteConfirmation');
        }

        // Ver resultados de una elecci√≥n
        function viewElectionResults(electionId) {
            const election = elections.find(e => e.id === electionId);
            if (!election) return;
            
            currentElection = election;
            document.getElementById('resultsModalTitle').textContent = `üìä Resultados: ${election.name}`;
            document.getElementById('resultsModal').style.display = 'flex';
            
            createResultsChart('bar');
            showResultsDetails(election);
        }

        // Crear gr√°fico de resultados
        function createResultsChart(type = 'bar') {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            
            if (resultsChart) {
                resultsChart.destroy();
            }
            
            const results = {};
            currentElection.candidates.forEach((candidate, index) => {
                results[index] = 0;
            });
            
            Object.values(currentElection.votes).forEach(vote => {
                results[vote] = (results[vote] || 0) + 1;
            });
            
            const totalVotes = Object.values(currentElection.votes).length;
            const labels = currentElection.candidates.map(c => c.name);
            const votesData = currentElection.candidates.map((_, index) => results[index] || 0);
            const percentages = votesData.map(votes => totalVotes > 0 ? (votes / totalVotes * 100) : 0);
            
            const backgroundColors = [
                'rgba(52, 152, 219, 0.8)',
                'rgba(46, 204, 113, 0.8)',
                'rgba(155, 89, 182, 0.8)',
                'rgba(241, 196, 15, 0.8)',
                'rgba(230, 126, 34, 0.8)',
                'rgba(231, 76, 60, 0.8)'
            ];
            
            const config = {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Porcentaje de Votos',
                        data: percentages,
                        backgroundColor: backgroundColors.slice(0, labels.length),
                        borderColor: backgroundColors.slice(0, labels.length).map(color => color.replace('0.8', '1')),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: `Distribuci√≥n de Votos - Total: ${totalVotes} votos`
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const votes = votesData[context.dataIndex];
                                    return `${label}: ${value.toFixed(1)}% (${votes} votos)`;
                                }
                            }
                        }
                    },
                    scales: type === 'bar' ? {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Porcentaje de Votos'
                            }
                        }
                    } : {}
                }
            };
            
            resultsChart = new Chart(ctx, config);
        }

        // Actualizar tipo de gr√°fico
        function updateChart(type) {
            createResultsChart(type);
        }

        // Mostrar detalles de resultados
        function showResultsDetails(election) {
            const resultsDetails = document.getElementById('resultsDetails');
            
            const results = {};
            election.candidates.forEach((candidate, index) => {
                results[index] = 0;
            });
            
            Object.values(election.votes).forEach(vote => {
                results[vote] = (results[vote] || 0) + 1;
            });
            
            const totalVotes = Object.values(election.votes).length;
            const totalVoters = election.voters.length;
            const participation = totalVoters > 0 ? (totalVotes / totalVoters * 100).toFixed(1) : 0;
            
            let maxVotes = 0;
            let winners = [];
            
            election.candidates.forEach((candidate, index) => {
                const votes = results[index] || 0;
                if (votes > maxVotes) {
                    maxVotes = votes;
                    winners = [candidate.name];
                } else if (votes === maxVotes && votes > 0) {
                    winners.push(candidate.name);
                }
            });
            
            let resultsHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: var(--border-radius); margin-top: 25px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 15px;">üìà Estad√≠sticas Detalladas</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary-color);">${totalVotes}</div>
                            <div style="color: var(--gray-color);">Votos Emitidos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary-color);">${totalVoters}</div>
                            <div style="color: var(--gray-color);">Total de Votantes</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary-color);">${participation}%</div>
                            <div style="color: var(--gray-color);">Participaci√≥n</div>
                        </div>
                    </div>
            `;
            
            if (winners.length > 0 && maxVotes > 0) {
                const winnerPercentage = totalVotes > 0 ? ((maxVotes / totalVotes) * 100).toFixed(1) : 0;
                resultsHTML += `
                    <div style="background: rgba(39, 174, 96, 0.1); padding: 15px; border-radius: var(--border-radius); border-left: 5px solid var(--success-color); margin-bottom: 15px;">
                        <h5 style="color: var(--success-color); margin-bottom: 10px;">üèÜ ${winners.length > 1 ? 'Empate' : 'Ganador'}</h5>
                        <p style="font-size: 1.1rem; font-weight: 600;">${winners.join(', ')}</p>
                        <p style="color: var(--gray-color); margin-top: 5px;">${maxVotes} votos (${winnerPercentage}%)</p>
                    </div>
                `;
            }
            
            resultsHTML += `
                <div style="margin-top: 20px;">
                    <h5 style="color: var(--primary-color); margin-bottom: 15px;">üìã Resultados por Candidato</h5>
            `;
            
            election.candidates.forEach((candidate, index) => {
                const votes = results[index] || 0;
                const percentage = totalVotes > 0 ? (votes / totalVotes * 100) : 0;
                const color = ['#3498db', '#2ecc71', '#9b59b6', '#f1c40f', '#e67e22', '#e74c3c'][index % 6];
                
                resultsHTML += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: ${color};"></div>
                                <span style="font-weight: 600;">${candidate.name}</span>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: bold; font-size: 1.1rem;">${percentage.toFixed(1)}%</div>
                                <div style="color: var(--gray-color); font-size: 0.9rem;">${votes} votos</div>
                            </div>
                        </div>
                        <div class="percentage-bar">
                            <div class="percentage-fill" style="width: ${percentage}%; background: ${color};">
                                <span class="percentage-text">${percentage.toFixed(1)}%</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            resultsHTML += `
                </div>
            </div>
            `;
            
            resultsDetails.innerHTML = resultsHTML;
        }

        // Cerrar modal de resultados
        function closeResultsModal() {
            document.getElementById('resultsModal').style.display = 'none';
            if (resultsChart) {
                resultsChart.destroy();
                resultsChart = null;
            }
        }

        // Eliminar una elecci√≥n
        function deleteElection(electionId) {
            if (confirm('¬øEst√° seguro de que desea eliminar esta elecci√≥n? Esta acci√≥n no se puede deshacer.')) {
                elections = elections.filter(e => e.id !== electionId);
                loadAdminPanel();
                saveData();
            }
        }

        // Mostrar alertas
        function showAlert(containerId, message, type) {
            const alertContainer = document.getElementById(containerId);
            alertContainer.innerHTML = `
                <div class="alert alert-${type}">${message}</div>
            `;
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Validar email
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Descargar plantilla de Excel
        function downloadTemplate() {
            const templateData = [
                ['Correo Electr√≥nico'],
                ['votante1@ejemplo.com'],
                ['votante2@ejemplo.com']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Votantes');
            XLSX.writeFile(wb, 'plantilla_votantes.xlsx');
        }

        // Manejar subida de archivo Excel
        function handleExcelUpload() {
            const fileInput = document.getElementById('excelFile');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                if (jsonData.length < 1 || jsonData[0][0] !== 'Correo Electr√≥nico') {
                    showAlert('adminAlert', 'El archivo no tiene el formato correcto.', 'error');
                    return;
                }
                
                const newVoters = [];
                
                for (let i = 1; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (row.length >= 1 && row[0]) {
                        const email = row[0].toString().trim();
                        if (isValidEmail(email)) {
                            newVoters.push(email);
                        }
                    }
                }
                
                if (newVoters.length === 0) {
                    showAlert('adminAlert', 'No se encontraron votantes v√°lidos.', 'error');
                    return;
                }
                
                currentVoters = [...currentVoters, ...newVoters];
                renderVoterList();
                showAlert('adminAlert', `${newVoters.length} votantes importados.`, 'success');
                fileInput.value = '';
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Exportar lista de votantes
        function exportVoters() {
            if (currentVoters.length === 0) {
                showAlert('adminAlert', 'No hay votantes para exportar.', 'error');
                return;
            }
            
            const data = [['Correo Electr√≥nico']];
            currentVoters.forEach(voter => data.push([voter]));
            
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Votantes');
            XLSX.writeFile(wb, 'lista_votantes.xlsx');
        }

        // Exportar resultados de elecci√≥n
        function exportResults() {
            if (!currentElection) return;
            
            const results = {};
            currentElection.candidates.forEach((candidate, index) => {
                results[index] = 0;
            });
            
            Object.values(currentElection.votes).forEach(vote => {
                results[vote] = (results[vote] || 0) + 1;
            });
            
            const totalVotes = Object.values(currentElection.votes).length;
            const totalVoters = currentElection.voters.length;
            const participation = totalVoters > 0 ? (totalVotes / totalVoters * 100).toFixed(1) : 0;
            
            const data = [
                ['REPORTE DE RESULTADOS'],
                [],
                ['Elecci√≥n:', currentElection.name],
                ['Descripci√≥n:', currentElection.description],
                ['Fecha:', new Date().toLocaleDateString()],
                [],
                ['ESTAD√çSTICAS'],
                ['Total votantes:', totalVoters],
                ['Votos emitidos:', totalVotes],
                ['Participaci√≥n:', `${participation}%`],
                [],
                ['RESULTADOS POR CANDIDATO'],
                ['Candidato', 'Votos', 'Porcentaje']
            ];
            
            currentElection.candidates.forEach((candidate, index) => {
                const votes = results[index] || 0;
                const percentage = totalVotes > 0 ? (votes / totalVotes * 100).toFixed(1) : 0;
                data.push([candidate.name, votes, `${percentage}%`]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Resultados');
            XLSX.writeFile(wb, `resultados_${currentElection.name.replace(/\s+/g, '_')}.xlsx`);
        }

        // Guardar datos en localStorage
        function saveData() {
            localStorage.setItem('electionsData', JSON.stringify(elections));
        }

        // Cargar datos desde localStorage
        function loadData() {
            const savedData = localStorage.getItem('electionsData');
            if (savedData) {
                elections = JSON.parse(savedData);
            }
        }

        // Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Manejar la instalaci√≥n de la PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'block';
        });

        document.getElementById('installBtn').addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        document.getElementById('installBtn').style.display = 'none';
                    }
                    deferredPrompt = null;
                });
            }
        });
    </script>
</body>
</html>



